
/***************************************************************************************************
*	Include Files
***************************************************************************************************/
#include <linux/ctype.h>
#include <linux/delay.h>
#include <linux/ioport.h>
#include "api_functions.h"

/***************************************************************************************************
*	Constant Definitionsg
***************************************************************************************************/


/***************************************************************************************************
*	Type Definitions
***************************************************************************************************/


/***************************************************************************************************
*	Macros (Inline Functions) Definitions
***************************************************************************************************/



/***************************************************************************************************
*	Variable Definitions
***************************************************************************************************/
extern u16*	g_pfpgaAddr;
extern spinlock_t g_io_lock;

/***************************************************************************************************
*	Function Prototypes
***************************************************************************************************/

/***********************************************************************************************//**
* \brief		tg_reg_write
* \param		
* \return		status
* \note
***************************************************************************************************/
void tg_reg_write(u32 a_naddr, u16 a_wdata)
{
	unsigned long flags = 0;
	spin_lock_irqsave(&g_io_lock, flags);
	(*((volatile u16 *)((volatile u16 *)g_pfpgaAddr + (a_naddr)))) = a_wdata;
	spin_unlock_irqrestore(&g_io_lock, flags);
}
EXPORT_SYMBOL(tg_reg_write);

/***********************************************************************************************//**
* \brief		tg_reg_write_dump
* \param		
* \return		status
* \note
***************************************************************************************************/
void tg_reg_write_dump(u16 a_n_addr, u16 a_n_length, u16* a_p_data)
{
	u32 n_idx;
	
	for( n_idx = 0 ; n_idx < a_n_length ; n_idx++)
	{
		tg_reg_write(a_n_addr + n_idx,a_p_data[n_idx]);
	}

	//memcpy(&(((u8*)g_pfpgaAddr)[a_n_addr]),&a_p_data,a_n_length);
	
}

/***********************************************************************************************//**
* \brief		tg_reg_read
* \param		
* \return		status
* \note
***************************************************************************************************/
u16 tg_reg_read(u32 a_naddr)
{
	u16 ret;

	ret = *((volatile u16 *)((volatile u16 *)g_pfpgaAddr + (a_naddr))) ;

	return ret;
}
EXPORT_SYMBOL(tg_reg_read);

/***********************************************************************************************//**
* \brief		tg_bst_read
* \param		
* \return		status
* \note
***************************************************************************************************/
void tg_bst_read(u32 a_naddr, u16 *a_pdata)
{
	u32 nidx;
	volatile u16 *paddr = ((volatile u16 *)((volatile u16 *)g_pfpgaAddr + (a_naddr)));
	
	for( nidx =0 ; nidx < 20 ; nidx++)
	{
		a_pdata[nidx] = paddr[nidx];
	}
}


/******************************************************************************/
/**
 * @brief   
 * @param   
 * @return  
 * @note    
*******************************************************************************/
void print_current_time(void)
{
	struct timespec64 t;
    struct tm broken;

    ktime_get_real_ts64(&t);
    time64_to_tm(t.tv_sec, 0, &broken);

    printk("--> %d:%02d:%02d-%02d:%02d:%02d:%06ld\n", (int)(broken.tm_year + 1900), broken.tm_mon + 1,
           broken.tm_mday, broken.tm_hour, broken.tm_min, broken.tm_sec, t.tv_nsec/1000);
}



/* end of api_functions.c */

